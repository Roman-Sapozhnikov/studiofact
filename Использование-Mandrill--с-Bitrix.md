Оригинал http://bykov.su/entries/podsazhivaem-bitrix-na-mandrill/



Mandrill – это сервис отправки транзакционных писем, но не простой отправки, а очень правильной, с максимальным deliverability, статистикой, сертификатами и подписями.

Т.е. своими силами сделать деливерабилити рейт писем близкий к 100% почти невозможно. Я даже не представляю как это сделать. У меня теряется где-то процентов 60% всех писем. А мандрил делает так, что ваши письма почти гарантировано будут доходить до получателя, не будут попадать в спам и будут иметь специальные пометки, что это хорошие письма. Ну и со статистикой это всё открытий, доставок, баунсов и прочего.

Представим, что вы уже знаете чем вам мандрил и у вас есть сайт на битриксе. И научить битрикс отправлять все свои стандартные почтовые сообщения через mandrill по smtp очень легко.

Если вы ставили bitrix-env 4+, то у вас уже установлен msmtp. Если нет – надо его поставить:

yum install msmtp

Вы же линуксом пользуетесь? :)

Дальше а настройках php нужно поменять sendmail_path на msmtp, если этого еще не сделано.

Дальше редактируете файл .msmtprc в папке /etc, /root или /home/bitrix (если стоит битрикс-env), вносите туда данные mandrill:

account default
logfile /home/bitrix/.msmtp.log
host localhost
port 25
from mailbox@localhost
keepbcc on
auth off

account mandrill
logfile /home/somesite/logs/msmtp.log
host smtp.mandrillapp.com
port 587
tls off
tls_starttls off
tls_certcheck off
from somesite <hello@somesite.ru>
auth login
user mandrill_login
password mandrill_valid_api_key

В этом фале описаны 2 разных экаунта msmtp: 1 по-умолчанию (default) который используется всегда, если не задан экаунт принудительно. Он, соответственно, делает отправку почты стандартными средствами. И второй экаунт (madrill) – он отправляет почту через mandrill соответственно. Поля user и password – соответственно логин от сервиса и любой активный api ключ.

А дальше вообще элементарная штука – в настройках главного модуля сайта нужно добавить 1 строчку: